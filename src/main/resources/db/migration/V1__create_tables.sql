-- src/main/resources/db/migration/V1__create_tables.sql

-- Table for live cache records
CREATE TABLE CACHE_RECORD (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    FIELD1 VARCHAR2(255),
    FIELD2 VARCHAR2(255),
    CACHE_KEY VARCHAR2(50)
);

-- Table for staging cache records
CREATE TABLE CACHE_RECORD_STAGING (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    FIELD1 VARCHAR2(255),
    FIELD2 VARCHAR2(255),
    CACHE_KEY VARCHAR2(50)
);

-- Control table to hold the current active cache key
CREATE TABLE CACHE_VERSION (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ACTIVE_CACHE_KEY VARCHAR2(50)
);

-- Insert an initial row into CACHE_VERSION (optional)
INSERT INTO CACHE_VERSION (ACTIVE_CACHE_KEY) VALUES (NULL);
COMMIT;

-- Logging table to record job execution details
CREATE TABLE JOB_LOG (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    JOB_NAME VARCHAR2(100),
    START_TIME TIMESTAMP,
    END_TIME TIMESTAMP,
    DURATION_MS NUMBER,
    STATUS VARCHAR2(20),
    ERROR_MESSAGE VARCHAR2(4000)
);